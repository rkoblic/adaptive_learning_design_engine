{% extends "base.html" %}

{% block title %}Generated Course | Adaptive Learning Design Engine{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">
    <!-- Progress Indicator -->
    <div class="mb-8">
        <div class="flex items-center justify-center space-x-4">
            <div class="flex items-center">
                <div class="w-10 h-10 rounded-full bg-green-500 text-white flex items-center justify-center font-bold">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                </div>
                <span class="ml-2 text-green-600">Input Details</span>
            </div>
            <div class="w-16 h-1 bg-green-500"></div>
            <div class="flex items-center">
                <div class="w-10 h-10 rounded-full bg-green-500 text-white flex items-center justify-center font-bold">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                </div>
                <span class="ml-2 text-green-600">Review & Confirm</span>
            </div>
            <div class="w-16 h-1 bg-green-500"></div>
            <div class="flex items-center">
                <div class="w-10 h-10 rounded-full bg-primary text-white flex items-center justify-center font-bold">3</div>
                <span class="ml-2 font-medium text-primary">Generated Course</span>
            </div>
        </div>
    </div>

    <!-- Success Banner -->
    <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
        <div class="flex items-center">
            <svg class="w-6 h-6 text-green-500 mr-3" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
            </svg>
            <div>
                <h3 class="font-medium text-green-800">Course Shell Generated Successfully</h3>
                <p class="text-sm text-green-700">Your complete curriculum is ready. Download or review below.</p>
            </div>
        </div>
    </div>

    <!-- Action Bar -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6 flex items-center justify-between">
        <div class="flex items-center gap-4">
            <span class="text-sm text-gray-500" id="sectionCount">6 sections</span>
            <span class="text-gray-300">|</span>
            <a href="{{ url_for('back_to_confirm') }}" class="text-sm text-gray-600 hover:text-primary">
                &larr; Edit Inputs
            </a>
            <a href="{{ url_for('intake_form') }}" class="text-sm text-gray-600 hover:text-primary">
                Start New Course
            </a>
        </div>
        <div class="flex items-center gap-2">
            <button onclick="copyToClipboard()" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors flex items-center">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path>
                </svg>
                Copy
            </button>
            <a href="{{ url_for('download_curriculum') }}" class="px-4 py-2 text-sm font-medium text-white bg-primary rounded-lg hover:bg-indigo-700 transition-colors flex items-center">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                </svg>
                Download
            </a>
        </div>
    </div>

    <!-- Course Title Header -->
    <div id="course-title-header" class="bg-gradient-to-r from-indigo-600 to-purple-600 rounded-xl shadow-lg p-8 mb-6 text-white">
        <p class="text-indigo-200 text-sm font-medium uppercase tracking-wide mb-2">Generated Course Shell</p>
        <h1 id="course-title-display" class="text-3xl md:text-4xl font-bold mb-2">
            {{ data.project.project_title if data and data.project and data.project.project_title else 'Course Shell' }}
        </h1>
        <p id="course-credit-display" class="text-indigo-100 text-lg">
            {% if data and data.institution and data.institution.credit_hours %}
                {{ data.institution.credit_hours }} Credit Hours
            {% endif %}
        </p>
    </div>

    <!-- Section Cards Grid -->
    <div id="section-cards-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
        <!-- Cards will be dynamically populated -->
    </div>

    <!-- Hidden original content for parsing -->
    <div class="prose prose-indigo max-w-none hidden" id="original-content">
        {{ curriculum_html|safe }}
    </div>

    <!-- Hidden textarea for clipboard -->
    <textarea id="markdown-content" class="hidden">{{ curriculum_markdown }}</textarea>
</div>

<!-- Section Detail Modal -->
<div id="section-modal" class="fixed inset-0 z-50 hidden">
    <!-- Backdrop -->
    <div class="modal-backdrop absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closeModal()"></div>

    <!-- Modal Content -->
    <div class="modal-container absolute inset-4 md:inset-8 lg:inset-12 bg-white rounded-2xl shadow-2xl flex flex-col overflow-hidden">
        <!-- Modal Header -->
        <div id="modal-header" class="flex items-center justify-between px-6 py-4 border-b">
            <div class="flex items-center">
                <span id="modal-icon" class="text-3xl mr-4">ðŸ“š</span>
                <div>
                    <h2 id="modal-title" class="text-xl font-bold text-gray-900">Section Title</h2>
                    <p id="modal-subtitle" class="text-sm text-gray-500">Click outside or press Escape to close</p>
                </div>
            </div>
            <div class="flex items-center gap-2">
                <!-- Navigation buttons -->
                <button onclick="navigateSection(-1)" id="prev-section-btn" class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors" title="Previous section">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                </button>
                <button onclick="navigateSection(1)" id="next-section-btn" class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors" title="Next section">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                </button>
                <div class="w-px h-6 bg-gray-200 mx-2"></div>
                <button onclick="closeModal()" class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors" title="Close">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Modal Body -->
        <div id="modal-body" class="flex-1 overflow-y-auto p-6 md:p-8">
            <div id="modal-content" class="prose prose-indigo max-w-none">
                <!-- Section content will be injected here -->
            </div>
        </div>
    </div>
</div>

<!-- Back to Top Button -->
<button id="back-to-top" class="fixed bottom-8 right-8 p-3 bg-primary text-white rounded-full shadow-lg opacity-0 transition-opacity hover:bg-indigo-700" onclick="scrollToTop()">
    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
    </svg>
</button>

<!-- Toast Notification -->
<div id="toast" class="fixed bottom-8 left-1/2 transform -translate-x-1/2 px-6 py-3 bg-gray-900 text-white rounded-lg shadow-lg opacity-0 transition-opacity">
    Copied to clipboard!
</div>
{% endblock %}

{% block scripts %}
<script>
    // Section configuration with colors and icons
    const sectionConfig = {
        'course': { color: 'blue', icon: 'ðŸ“š', title: 'Course Overview', order: 1 },
        'learning': { color: 'green', icon: 'ðŸŽ¯', title: 'Learning Objectives', order: 2 },
        'grading': { color: 'indigo', icon: 'ðŸ“Š', title: 'Grading Breakdown', order: 3 },
        'weekly': { color: 'purple', icon: 'ðŸ“…', title: 'Weekly Schedule', order: 4 },
        'reflection': { color: 'amber', icon: 'ðŸ’­', title: 'Reflection Prompts', order: 5 },
        'assessment': { color: 'teal', icon: 'ðŸ“‹', title: 'Assessment Package', order: 6 }
    };

    // Color classes for each section type
    const colorClasses = {
        'blue': { bg: 'bg-blue-50', border: 'border-blue-200', text: 'text-blue-800', iconBg: 'bg-blue-100', headerBg: 'bg-blue-50' },
        'green': { bg: 'bg-green-50', border: 'border-green-200', text: 'text-green-800', iconBg: 'bg-green-100', headerBg: 'bg-green-50' },
        'purple': { bg: 'bg-purple-50', border: 'border-purple-200', text: 'text-purple-800', iconBg: 'bg-purple-100', headerBg: 'bg-purple-50' },
        'amber': { bg: 'bg-amber-50', border: 'border-amber-200', text: 'text-amber-800', iconBg: 'bg-amber-100', headerBg: 'bg-amber-50' },
        'teal': { bg: 'bg-teal-50', border: 'border-teal-200', text: 'text-teal-800', iconBg: 'bg-teal-100', headerBg: 'bg-teal-50' },
        'indigo': { bg: 'bg-indigo-50', border: 'border-indigo-200', text: 'text-indigo-800', iconBg: 'bg-indigo-100', headerBg: 'bg-indigo-50' }
    };

    // Store parsed sections globally
    let parsedSections = [];
    let currentModalIndex = -1;

    // Determine section type from title
    function getSectionType(title) {
        const lowerTitle = title.toLowerCase();
        if (lowerTitle.includes('course') || lowerTitle.includes('header') || lowerTitle.includes('credit')) return 'course';
        if (lowerTitle.includes('learning') || lowerTitle.includes('objective')) return 'learning';
        if (lowerTitle.includes('weekly') || lowerTitle.includes('schedule') || lowerTitle.includes('week')) return 'weekly';
        if (lowerTitle.includes('reflection')) return 'reflection';
        if (lowerTitle.includes('assessment') || lowerTitle.includes('rubric') || lowerTitle.includes('evaluation')) return 'assessment';
        if (lowerTitle.includes('grading') || lowerTitle.includes('breakdown')) return 'grading';
        return 'course'; // default
    }

    // Initialize the card grid layout
    document.addEventListener('DOMContentLoaded', function() {
        const originalContent = document.getElementById('original-content');
        const cardsGrid = document.getElementById('section-cards-grid');

        // Parse content and group by H2 sections
        let currentSection = null;
        let preContent = []; // Content before first H2

        Array.from(originalContent.children).forEach(node => {
            if (node.tagName === 'H2') {
                if (currentSection) {
                    parsedSections.push(currentSection);
                }
                currentSection = {
                    title: node.textContent.trim(),
                    elements: [],
                    id: node.textContent.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)/g, '')
                };
            } else if (currentSection) {
                currentSection.elements.push(node.cloneNode(true));
            } else {
                preContent.push(node.cloneNode(true));
            }
        });
        if (currentSection) {
            parsedSections.push(currentSection);
        }

        // Sort sections by configured order
        parsedSections.sort((a, b) => {
            const typeA = getSectionType(a.title);
            const typeB = getSectionType(b.title);
            const orderA = sectionConfig[typeA]?.order || 99;
            const orderB = sectionConfig[typeB]?.order || 99;
            return orderA - orderB;
        });

        // Build preview cards for each section
        parsedSections.forEach((section, index) => {
            const sectionType = getSectionType(section.title);
            const config = sectionConfig[sectionType] || sectionConfig['course'];
            const colors = colorClasses[config.color] || colorClasses['blue'];

            const card = document.createElement('div');
            card.className = `section-preview-card group cursor-pointer bg-white rounded-xl border-2 ${colors.border} hover:shadow-lg transition-all duration-200 overflow-hidden`;
            card.onclick = () => openModal(index);

            // Card content
            card.innerHTML = `
                <div class="p-5">
                    <div class="flex items-start justify-between mb-3">
                        <div class="w-12 h-12 rounded-xl ${colors.iconBg} flex items-center justify-center text-2xl">
                            ${config.icon}
                        </div>
                        <svg class="w-5 h-5 text-gray-300 group-hover:text-gray-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </div>
                    <h3 class="font-semibold text-gray-900 mb-2 group-hover:${colors.text} transition-colors">
                        <span class="text-gray-400 mr-1">${index + 1}.</span> ${config.title.toUpperCase()}
                    </h3>
                    <p class="text-sm text-gray-500 line-clamp-2">${getPreview(section)}</p>
                </div>
                <div class="px-5 py-3 ${colors.bg} border-t ${colors.border}">
                    <span class="text-xs font-medium ${colors.text}">Click to view details</span>
                </div>
            `;

            cardsGrid.appendChild(card);
        });

        // Update section count
        document.getElementById('sectionCount').textContent = `${parsedSections.length} sections`;
    });

    // Get preview text for a section
    function getPreview(section) {
        // Try to get text from first paragraph
        const firstPara = section.elements.find(el => el.tagName === 'P');
        if (firstPara) {
            const text = firstPara.textContent.trim();
            return text.length > 100 ? text.substring(0, 100) + '...' : text;
        }

        // Count list items
        const lists = section.elements.filter(el => el.tagName === 'UL' || el.tagName === 'OL');
        if (lists.length > 0) {
            const itemCount = lists.reduce((sum, list) => sum + list.querySelectorAll('li').length, 0);
            return `Contains ${itemCount} items`;
        }

        // Count subheadings (for weekly schedule)
        const subheadings = section.elements.filter(el => el.tagName === 'H3');
        if (subheadings.length > 0) {
            return `${subheadings.length} subsections`;
        }

        return 'Click to view full content';
    }

    // Open modal with section content
    function openModal(index) {
        currentModalIndex = index;
        const section = parsedSections[index];
        const sectionType = getSectionType(section.title);
        const config = sectionConfig[sectionType] || sectionConfig['course'];
        const colors = colorClasses[config.color] || colorClasses['blue'];

        // Update modal header
        document.getElementById('modal-icon').textContent = config.icon;
        document.getElementById('modal-title').textContent = config.title;
        document.getElementById('modal-subtitle').textContent = `Section ${index + 1} of ${parsedSections.length}`;

        // Style header with section color
        const modalHeader = document.getElementById('modal-header');
        modalHeader.className = `flex items-center justify-between px-6 py-4 border-b ${colors.headerBg} ${colors.border}`;

        // Populate modal content
        const modalContent = document.getElementById('modal-content');
        modalContent.innerHTML = '';
        section.elements.forEach(el => {
            const cloned = el.cloneNode(true);
            modalContent.appendChild(cloned);
        });

        // Apply special styling
        applySpecialStyling(modalContent, section.title);

        // Update navigation buttons
        document.getElementById('prev-section-btn').disabled = index === 0;
        document.getElementById('prev-section-btn').classList.toggle('opacity-30', index === 0);
        document.getElementById('next-section-btn').disabled = index === parsedSections.length - 1;
        document.getElementById('next-section-btn').classList.toggle('opacity-30', index === parsedSections.length - 1);

        // Show modal
        const modal = document.getElementById('section-modal');
        modal.classList.remove('hidden');
        document.body.classList.add('overflow-hidden');

        // Scroll modal body to top
        document.getElementById('modal-body').scrollTop = 0;
    }

    // Close modal
    function closeModal() {
        const modal = document.getElementById('section-modal');
        modal.classList.add('hidden');
        document.body.classList.remove('overflow-hidden');
        currentModalIndex = -1;
    }

    // Navigate between sections in modal
    function navigateSection(direction) {
        const newIndex = currentModalIndex + direction;
        if (newIndex >= 0 && newIndex < parsedSections.length) {
            openModal(newIndex);
        }
    }

    // Apply special styling for specific section types
    function applySpecialStyling(container, title) {
        const lowerTitle = title.toLowerCase();

        // Style Learning Objectives section
        if (lowerTitle.includes('learning objectives')) {
            container.querySelectorAll('h4').forEach(h4 => {
                if (h4.textContent.toLowerCase().includes('fixed objectives')) {
                    h4.classList.add('objective-subheader', 'objective-fixed');
                } else if (h4.textContent.toLowerCase().includes('variable objectives')) {
                    h4.classList.add('objective-subheader', 'objective-variable');
                }
            });
        }

        // Style Weekly Schedule section
        if (lowerTitle.includes('weekly schedule')) {
            // First, style Kolb cycle phase headers
            container.querySelectorAll('h4').forEach(h4 => {
                const text = h4.textContent.toLowerCase();
                if (text.includes('concrete experience')) {
                    h4.classList.add('kolb-phase', 'kolb-experience');
                } else if (text.includes('reflective observation')) {
                    h4.classList.add('kolb-phase', 'kolb-reflection');
                } else if (text.includes('abstract conceptualization')) {
                    h4.classList.add('kolb-phase', 'kolb-conceptualization');
                } else if (text.includes('active experimentation')) {
                    h4.classList.add('kolb-phase', 'kolb-experimentation');
                } else if (text.includes('deliverables due') || text.includes('deliverable')) {
                    h4.classList.add('kolb-phase', 'kolb-deliverables');
                } else if (text.includes('milestone')) {
                    h4.classList.add('kolb-phase', 'kolb-milestone');
                }
            });

            // Wrap each week in a container
            const weekHeaders = Array.from(container.querySelectorAll('h3')).filter(h3 =>
                h3.textContent.toLowerCase().startsWith('week')
            );

            weekHeaders.forEach((weekHeader, index) => {
                // Create week container
                const weekContainer = document.createElement('div');
                weekContainer.className = 'week-container';

                // Style the header
                weekHeader.classList.add('week-header');

                // Create content wrapper
                const weekContent = document.createElement('div');
                weekContent.className = 'week-content';

                // Find all siblings until the next week header
                let nextSibling = weekHeader.nextElementSibling;
                const contentElements = [];

                while (nextSibling && !nextSibling.matches('h3')) {
                    contentElements.push(nextSibling);
                    nextSibling = nextSibling.nextElementSibling;
                }

                // Insert the container before the header
                weekHeader.parentNode.insertBefore(weekContainer, weekHeader);

                // Move header and content into container
                weekContainer.appendChild(weekHeader);
                contentElements.forEach(el => weekContent.appendChild(el));
                weekContainer.appendChild(weekContent);
            });
        }
    }

    // Keyboard navigation
    document.addEventListener('keydown', function(e) {
        if (currentModalIndex === -1) return; // Modal not open

        if (e.key === 'Escape') {
            closeModal();
        } else if (e.key === 'ArrowLeft') {
            navigateSection(-1);
        } else if (e.key === 'ArrowRight') {
            navigateSection(1);
        }
    });

    // Copy to clipboard
    function copyToClipboard() {
        const content = document.getElementById('markdown-content').value;
        navigator.clipboard.writeText(content).then(() => {
            showToast('Copied to clipboard!');
        }).catch(() => {
            const textarea = document.getElementById('markdown-content');
            textarea.classList.remove('hidden');
            textarea.select();
            document.execCommand('copy');
            textarea.classList.add('hidden');
            showToast('Copied to clipboard!');
        });
    }

    // Show toast notification
    function showToast(message) {
        const toast = document.getElementById('toast');
        toast.textContent = message;
        toast.classList.remove('opacity-0');
        toast.classList.add('opacity-100');
        setTimeout(() => {
            toast.classList.remove('opacity-100');
            toast.classList.add('opacity-0');
        }, 2000);
    }

    // Back to top button
    const backToTopBtn = document.getElementById('back-to-top');
    window.addEventListener('scroll', () => {
        if (window.scrollY > 300) {
            backToTopBtn.classList.remove('opacity-0');
            backToTopBtn.classList.add('opacity-100');
        } else {
            backToTopBtn.classList.remove('opacity-100');
            backToTopBtn.classList.add('opacity-0');
        }
    });

    function scrollToTop() {
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }
</script>

<style>
    /* Card preview styling */
    .section-preview-card {
        transition: all 0.2s ease-in-out;
    }
    .section-preview-card:hover {
        transform: translateY(-2px);
    }
    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    /* Modal styling */
    #section-modal {
        animation: fadeIn 0.15s ease-out;
    }
    .modal-backdrop {
        animation: fadeIn 0.15s ease-out;
    }
    .modal-container {
        animation: slideUp 0.2s ease-out;
    }
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    @keyframes slideUp {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    /* Modal scrollbar styling */
    #modal-body::-webkit-scrollbar {
        width: 8px;
    }
    #modal-body::-webkit-scrollbar-track {
        background: #f1f5f9;
        border-radius: 4px;
    }
    #modal-body::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 4px;
    }
    #modal-body::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
    }

    /* ========================================
       MODAL CONTENT - PROSE STYLING
       Enhanced typography and spacing for readability
       ======================================== */

    /* Base modal content area */
    #modal-content {
        @apply text-gray-700 leading-relaxed;
        font-size: 1rem;
        line-height: 1.75;
    }

    /* Header Hierarchy - Clear visual distinction */
    .prose h1 {
        @apply text-3xl font-bold text-gray-900 pb-4 mb-6;
        border-bottom: 3px solid #e5e7eb;
    }

    .prose h2 {
        @apply text-2xl font-bold text-gray-900 mt-10 mb-5 pb-3;
        border-bottom: 2px solid #e5e7eb;
    }

    .prose h3 {
        @apply text-xl font-semibold text-gray-800 mt-8 mb-4;
        padding-left: 0.75rem;
        border-left: 4px solid #6366f1;
    }

    .prose h4 {
        @apply text-lg font-semibold text-gray-700 mt-6 mb-3;
        letter-spacing: 0.025em;
    }

    .prose h5 {
        @apply text-base font-semibold text-gray-600 mt-5 mb-2 uppercase tracking-wide;
    }

    /* First heading in modal shouldn't have top margin */
    #modal-content > h1:first-child,
    #modal-content > h2:first-child,
    #modal-content > h3:first-child,
    #modal-content > h4:first-child {
        @apply mt-0;
    }

    /* Learning Objectives subheader styling */
    .objective-subheader {
        @apply text-base font-semibold py-2 px-4 rounded-lg mt-6 mb-4 border-l-4;
    }
    .objective-fixed {
        @apply bg-emerald-50 text-emerald-800 border-emerald-500;
    }
    .objective-variable {
        @apply bg-blue-50 text-blue-800 border-blue-500;
    }

    /* Week container styling */
    .week-container {
        @apply bg-white rounded-xl border border-gray-200 shadow-sm mb-6 overflow-hidden;
    }

    /* Week header styling within Weekly Schedule */
    .week-header {
        @apply text-lg font-bold py-4 px-5 bg-gradient-to-r from-purple-600 to-indigo-600 text-white m-0;
    }
    .week-header:first-of-type {
        @apply mt-0;
    }

    /* Week content area */
    .week-content {
        @apply p-5;
    }

    /* Kolb cycle phase styling */
    .kolb-phase {
        @apply text-xs font-bold uppercase tracking-wider py-1.5 px-3 rounded-full mt-6 mb-3 inline-flex items-center;
    }
    .kolb-phase::before {
        content: '';
        @apply w-2 h-2 rounded-full mr-2;
    }
    .kolb-experience {
        @apply bg-orange-100 text-orange-700;
    }
    .kolb-experience::before {
        @apply bg-orange-500;
    }
    .kolb-reflection {
        @apply bg-sky-100 text-sky-700;
    }
    .kolb-reflection::before {
        @apply bg-sky-500;
    }
    .kolb-conceptualization {
        @apply bg-violet-100 text-violet-700;
    }
    .kolb-conceptualization::before {
        @apply bg-violet-500;
    }
    .kolb-experimentation {
        @apply bg-emerald-100 text-emerald-700;
    }
    .kolb-experimentation::before {
        @apply bg-emerald-500;
    }
    .kolb-deliverables {
        @apply bg-rose-100 text-rose-700;
    }
    .kolb-deliverables::before {
        @apply bg-rose-500;
    }
    .kolb-milestone {
        @apply bg-amber-100 text-amber-700;
    }
    .kolb-milestone::before {
        @apply bg-amber-500;
    }

    /* First kolb phase in a week doesn't need top margin */
    .week-content .kolb-phase:first-child {
        @apply mt-0;
    }

    /* Content following kolb phase headers */
    .kolb-phase + p,
    .kolb-phase + ul,
    .kolb-phase + ol {
        @apply mt-2 mb-5 ml-4 pl-4 border-l-2 border-gray-200;
    }

    /* Nested lists in weekly schedule */
    .week-content ul {
        @apply space-y-2;
    }
    .week-content li {
        @apply text-gray-700 leading-relaxed;
    }
    /* Paragraphs - Comfortable reading spacing */
    .prose p {
        @apply text-gray-600 mb-5;
        line-height: 1.8;
    }

    /* Adjacent paragraphs get less margin */
    .prose p + p {
        @apply mt-0;
    }

    /* Paragraph after heading gets reduced top spacing */
    .prose h3 + p,
    .prose h4 + p {
        @apply mt-2;
    }

    /* ========================================
       LIST STYLING - Enhanced bullets and spacing
       ======================================== */

    .prose ul {
        @apply my-5 pl-0 space-y-3;
        list-style: none;
    }

    .prose ol {
        @apply my-5 pl-0 space-y-3;
        list-style: none;
        counter-reset: list-counter;
    }

    /* Unordered list items with custom bullets */
    .prose ul > li {
        @apply text-gray-600 pl-7 relative;
        line-height: 1.7;
    }

    .prose ul > li::before {
        content: '';
        @apply absolute left-0 top-2.5 w-2 h-2 rounded-full bg-indigo-500;
    }

    /* Ordered list items with custom numbers */
    .prose ol > li {
        @apply text-gray-600 pl-8 relative;
        line-height: 1.7;
        counter-increment: list-counter;
    }

    .prose ol > li::before {
        content: counter(list-counter) ".";
        @apply absolute left-0 top-0 font-semibold text-indigo-600;
    }

    /* Nested lists */
    .prose ul ul,
    .prose ol ul {
        @apply mt-3 mb-0 pl-4;
    }

    .prose ul ul > li::before {
        @apply w-1.5 h-1.5 bg-gray-400;
    }

    .prose ol ol,
    .prose ul ol {
        @apply mt-3 mb-0 pl-4;
        counter-reset: nested-counter;
    }

    .prose ol ol > li::before,
    .prose ul ol > li::before {
        counter-increment: nested-counter;
        content: counter(nested-counter, lower-alpha) ".";
        @apply text-gray-500 font-medium;
    }

    /* ========================================
       TABLE STYLING - Clean and readable
       ======================================== */

    .prose table {
        @apply w-full my-8 text-sm;
        border-collapse: separate;
        border-spacing: 0;
        border-radius: 0.5rem;
        overflow: hidden;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .prose thead {
        @apply bg-gradient-to-r from-gray-100 to-gray-50;
    }

    .prose th {
        @apply px-5 py-4 text-left font-semibold text-gray-700 border-b-2 border-gray-200;
    }

    .prose td {
        @apply px-5 py-4 text-gray-600 border-b border-gray-100;
    }

    .prose tbody tr:last-child td {
        @apply border-b-0;
    }

    .prose tbody tr:hover {
        @apply bg-gray-50;
    }

    /* ========================================
       OTHER ELEMENTS - Blockquotes, code, etc.
       ======================================== */

    .prose blockquote {
        @apply my-6 py-4 px-6 bg-indigo-50 rounded-r-lg italic text-gray-700;
        border-left: 4px solid #6366f1;
    }

    .prose blockquote p {
        @apply mb-0;
    }

    .prose code {
        @apply bg-gray-100 px-2 py-1 rounded text-sm font-mono text-indigo-700;
    }

    .prose pre {
        @apply bg-gray-900 text-gray-100 p-5 rounded-lg overflow-x-auto my-6;
    }

    .prose pre code {
        @apply bg-transparent p-0 text-gray-100;
    }

    .prose hr {
        @apply my-10 border-0 h-px bg-gradient-to-r from-transparent via-gray-300 to-transparent;
    }

    /* Strong and emphasis */
    .prose strong {
        @apply font-semibold text-gray-800;
    }

    .prose em {
        @apply italic text-gray-700;
    }

    /* Links */
    .prose a {
        @apply text-indigo-600 font-medium underline decoration-indigo-300 hover:decoration-indigo-600 transition-colors;
    }

    /* ========================================
       SECTION DIVIDERS - Visual breaks between content
       ======================================== */

    /* Add subtle divider before major sections */
    .prose h2:not(:first-child)::before,
    .prose h3:not(:first-child)::before {
        content: '';
        display: block;
        height: 1px;
        @apply bg-gray-200 mb-8;
        margin-left: -0.75rem;
    }

    .prose h3:not(:first-child)::before {
        @apply mb-6;
    }

    /* ========================================
       CONTENT CARDS - For grouped information
       ======================================== */

    .prose .info-box,
    .prose .note,
    .prose .tip {
        @apply my-6 p-5 rounded-lg border;
    }

    .prose .info-box {
        @apply bg-blue-50 border-blue-200 text-blue-800;
    }

    .prose .note {
        @apply bg-amber-50 border-amber-200 text-amber-800;
    }

    .prose .tip {
        @apply bg-green-50 border-green-200 text-green-800;
    }

    /* ========================================
       SECTION-SPECIFIC STYLING
       ======================================== */

    /* Grading Breakdown - Enhanced table display */
    #modal-content table th:first-child,
    #modal-content table td:first-child {
        @apply font-medium text-gray-800;
    }

    /* Assessment rubric styling */
    #modal-content table td:last-child {
        @apply text-right;
    }

    /* Percentage/points column styling */
    #modal-content table td:last-child,
    #modal-content table th:last-child {
        min-width: 80px;
    }

    /* Course Overview - Key info highlighting */
    .prose p strong:first-child {
        @apply text-gray-700;
    }

    /* Learning Objectives - Objective items */
    #modal-content .prose ul li strong {
        @apply text-indigo-700 block mb-1;
    }

    /* Reflection Prompts - Question styling */
    .prose ol > li > p:first-child,
    .prose ul > li > p:first-child {
        @apply font-medium text-gray-800 mb-2;
    }

    /* ========================================
       MODAL BODY ENHANCEMENTS
       ======================================== */

    /* Better padding and max-width for readability */
    #modal-body {
        @apply bg-gray-50;
    }

    #modal-content {
        @apply bg-white rounded-xl shadow-sm p-8 mx-auto;
        max-width: 900px;
    }

    /* Responsive modal content padding */
    @media (max-width: 768px) {
        #modal-content {
            @apply p-5;
        }
    }

    /* Print styles */
    @media print {
        #back-to-top, #toast, #section-modal {
            display: none !important;
        }
        .section-preview-card {
            break-inside: avoid;
        }
    }

    /* Responsive action bar */
    @media (max-width: 640px) {
        #section-cards-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}
